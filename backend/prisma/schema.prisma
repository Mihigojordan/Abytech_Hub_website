// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Admin {
  id         String   @id @unique @default(uuid())
  adminName  String?
  adminEmail String?  @unique
  phone      String?
  location   String?
  identityCardPublicId String?
  passportPublicId     String?
  cvPublicId           String?
  profileImagePublicId String?
  password   String?
  profileImage String?
  status     AdminStatus @default(ACTIVE)
  google_id  String?  @unique
  is2FA      Boolean? @default(false)
  idNumber   Int?
  bio        String?
  experience Json?  // array of {from,to,companyName,jobTitle,JobDescription}
  joinedDate DateTime?
  isLocked   Boolean? @default(false)
  skills     Json?  // array
  portifilio Json?  // array

  // files
  cv          String?
  passport    String?
  identityCard String?

  // ðŸ†• Push notification subscription
  subscription Json? // stores the push subscription object (endpoint + keys)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  replies     ReplyReport[]
  expenses    Expense[]
  report      Report[]
}

enum AdminStatus {
  ACTIVE
  INACTIVE
}


model Expense {
  id          String   @id @default(uuid())
  title       String
  amount      Float
  status      ExpenseStatus @default(PENDING)
  description String?
  reason String?
  adminId     String
  createdAt   DateTime @default(now())
  admin    Admin    @relation(fields: [adminId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

enum ExpenseStatus{
    PENDING
    APPROVED
    REJECTED
    COMPLETED
}


model Report{
  id         String   @id @default(uuid())
  title       String
  content     Json?
  reportUrl   String?
  publicId    String?
  createdAt   DateTime 
  adminId    String
  admin   Admin    @relation(fields: [adminId], references: [id], onDelete: Cascade, onUpdate: Cascade)
   replies    ReplyReport[] 
}

model ReplyReport {
  id           String   @id @default(uuid())
  content      String

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Foreign keys
  reportId     String
  report       Report   @relation(fields: [reportId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  adminId      String
  admin        Admin    @relation(fields: [adminId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}
